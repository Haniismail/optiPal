{"ast":null,"code":"var _jsxFileName = \"/Users/takiacademy/Desktop/react-starter/src/contexts/JWTAuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport LoadingScreen from '../components/LoadingScreen';\nimport axios from '../utilities/axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialAuthState = {\n  isAuthenticated: false,\n  isInitialised: false\n};\nconst isValidToken = token => {\n  if (!token) {\n    return false;\n  }\n  const decoded = jwtDecode(token);\n  const currentTime = Date.now() / 1000;\n  return decoded.exp > currentTime;\n};\nconst setSession = token => {\n  if (token) {\n    localStorage.setItem('token', token);\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n  } else {\n    localStorage.removeItem('token');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'INITIALISE':\n      {\n        const {\n          isAuthenticated\n        } = action.payload;\n        return {\n          ...state,\n          isAuthenticated,\n          isInitialised: true\n        };\n      }\n    case 'LOGIN':\n      {\n        return {\n          ...state,\n          isAuthenticated: true\n        };\n      }\n    case 'LOGOUT':\n      {\n        return {\n          ...state,\n          isAuthenticated: false\n        };\n      }\n    default:\n      {\n        return {\n          ...state\n        };\n      }\n  }\n};\nconst AuthContext = /*#__PURE__*/createContext({\n  ...initialAuthState,\n  method: 'JWT',\n  login: () => Promise.resolve(),\n  logout: () => {}\n});\nexport const AuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, initialAuthState);\n  const login = async (username, password) => {\n    const response = await axios.post(`/auth/login_check`, {\n      username,\n      password\n    });\n    const {\n      token\n    } = response.data.payload;\n    setSession(token);\n    dispatch({\n      type: 'LOGIN',\n      payload: {}\n    });\n  };\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n  useEffect(() => {\n    const initialise = async () => {\n      try {\n        const token = window.localStorage.getItem('token');\n        if (token && isValidToken(token)) {\n          setSession(token);\n          dispatch({\n            type: 'INITIALISE',\n            payload: {\n              isAuthenticated: true\n            }\n          });\n        } else {\n          dispatch({\n            type: 'INITIALISE',\n            payload: {\n              isAuthenticated: false\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: 'INITIALISE',\n          payload: {\n            isAuthenticated: false\n          }\n        });\n      }\n    };\n    initialise();\n  }, []);\n  if (!state.isInitialised) {\n    return /*#__PURE__*/_jsxDEV(LoadingScreen, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      ...state,\n      method: 'JWT',\n      login,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"//4mWrSOuqoEUUutHOK3gWkly1o=\");\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useReducer","jwtDecode","LoadingScreen","axios","initialAuthState","isAuthenticated","isInitialised","isValidToken","token","decoded","currentTime","Date","now","exp","setSession","localStorage","setItem","defaults","headers","common","Authorization","removeItem","reducer","state","action","type","payload","AuthContext","method","login","Promise","resolve","logout","AuthProvider","children","dispatch","username","password","response","post","data","initialise","window","getItem","err","console","error"],"sources":["/Users/takiacademy/Desktop/react-starter/src/contexts/JWTAuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport LoadingScreen from '../components/LoadingScreen';\nimport axios from '../utilities/axios';\n\nconst initialAuthState = {\n  isAuthenticated: false,\n  isInitialised: false,\n};\n\nconst isValidToken = (token) => {\n  if (!token) {\n    return false;\n  }\n\n  const decoded = jwtDecode(token);\n  const currentTime = Date.now() / 1000;\n\n  return decoded.exp > currentTime;\n};\n\nconst setSession = (token) => {\n  if (token) {\n    localStorage.setItem('token', token);\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n  } else {\n    localStorage.removeItem('token');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'INITIALISE': {\n      const { isAuthenticated } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated,\n        isInitialised: true,\n      };\n    }\n    case 'LOGIN': {\n      return {\n        ...state,\n        isAuthenticated: true,\n      };\n    }\n    case 'LOGOUT': {\n      return {\n        ...state,\n        isAuthenticated: false,\n      };\n    }\n\n    default: {\n      return { ...state };\n    }\n  }\n};\n\nconst AuthContext = createContext({\n  ...initialAuthState,\n  method: 'JWT',\n  login: () => Promise.resolve(),\n  logout: () => {},\n});\n\nexport const AuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialAuthState);\n\n  const login = async (username, password) => {\n    const response = await axios.post(`/auth/login_check`, { username, password });\n    const { token } = response.data.payload;\n    setSession(token);\n    dispatch({\n      type: 'LOGIN',\n      payload: {},\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({ type: 'LOGOUT' });\n  };\n\n  useEffect(() => {\n    const initialise = async () => {\n      try {\n        const token = window.localStorage.getItem('token');\n\n        if (token && isValidToken(token)) {\n          setSession(token);\n\n          dispatch({\n            type: 'INITIALISE',\n            payload: {\n              isAuthenticated: true,\n            },\n          });\n        } else {\n          dispatch({\n            type: 'INITIALISE',\n            payload: {\n              isAuthenticated: false,\n            },\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: 'INITIALISE',\n          payload: {\n            isAuthenticated: false,\n          },\n        });\n      }\n    };\n\n    initialise();\n  }, []);\n\n  if (!state.isInitialised) {\n    return <LoadingScreen />;\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        ...state,\n        method: 'JWT',\n        login,\n        logout,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}